name: Deploy FullStack E-commerce App

on:
  push:
    branches: [main]

jobs:

  # ─────────── CLIENT DEPLOY ───────────
  client:
    name: Deploy Client to Netlify
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./Frontend
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: npm install

      - name: Build Client
        run: npm run build

      - name: Deploy Client to Netlify
        uses: nwtgck/actions-netlify@v2
        with:
          publish-dir: ./Frontend/dist
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: "Client deployed from GitHub Actions"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_CLIENT_SITE_ID }}

  # ─────────── ADMIN DEPLOY ───────────
  admin:
    name: Deploy Admin to Netlify
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./Admin
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: npm install

      - name: Build Admin
        run: npm run build

      - name: Deploy Admin to Netlify
        uses: nwtgck/actions-netlify@v2
        with:
          publish-dir: ./Admin/dist
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: "Admin deployed from GitHub Actions"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_ADMIN_SITE_ID }}

  # ─────────── BACKEND DEPLOY ───────────
  backend:
    name: Build Backend for Railway
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./Backend
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: npm install

      - name: Run Tests (Optional)
        run: npm test || echo "No tests configured"

# Note: Railway auto-deploys via GitHub integration
